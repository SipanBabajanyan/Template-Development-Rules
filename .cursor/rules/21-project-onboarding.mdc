---
description: План запуска нового проекта. Пошаговый процесс от ТЗ до готового проекта.
globs: []
alwaysApply: false
---

# ПЛАН ЗАПУСКА НОВОГО ПРОЕКТА

> Этот документ описывает полный процесс создания проекта от получения ТЗ до готового к деплою состояния.

---

## 🎯 ОБЗОР ПРОЦЕССА

```
┌─────────────────────────────────────────────────────────────────┐
│  ЭТАП 1          ЭТАП 2           ЭТАП 3          ЭТАП 4       │
│  ПОДГОТОВКА  →   ПЛАНИРОВАНИЕ →   ИНИЦИАЛИЗАЦИЯ → РАЗРАБОТКА   │
│  (30 мин)        (1-2 часа)       (30 мин)        (по ТЗ)      │
│                                                                 │
│  • ТЗ            • Архитектура    • Проект        • По этапам   │
│  • Размер        • Структура      • Конфиги       • PROGRESS    │
│  • Согласование  • Технологии     • docs/         • Commits     │
│                  • Согласование   • .env          • Тесты       │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📋 ЭТАП 1: ПОДГОТОВКА

### Шаг 1.1: Получение ТЗ

```markdown
## Что должно быть в ТЗ

### Минимум (обязательно):
- [ ] Что это за проект (описание)
- [ ] Для кого (целевая аудитория)
- [ ] Основные функции (список)

### Желательно:
- [ ] Дизайн/макеты (Figma)
- [ ] Примеры похожих проектов
- [ ] Приоритеты функций
- [ ] Сроки

### Опционально:
- [ ] Технические требования
- [ ] Интеграции (платёжки, API)
- [ ] Особые требования
```

### Шаг 1.2: Определение размера проекта

> Используй `99-project-size.mdc` для определения

```markdown
## Вопросы для определения размера

1. Сколько основных функций/модулей? 
   - До 5 → A (малый)
   - 5-15 → B (средний)  
   - 15+ → C (крупный)

2. Сколько страниц/экранов?
   - До 10 → A
   - 10-30 → B
   - 30+ → C

3. Есть ли сложная бизнес-логика?
   - Простой CRUD → A
   - Средняя сложность → B
   - Сложные процессы → C

4. Нужен ли отдельный backend?
   - Нет (Next.js API Routes) → A/B
   - Да (NestJS) → B/C
```

### Шаг 1.3: Согласование размера

```markdown
## Предложение: Размер проекта

**Анализ ТЗ:**
- [Краткое описание проекта]
- [Количество функций]
- [Сложность]

**Рекомендуемый размер:** [A/B/C]

**Обоснование:**
- [Причина 1]
- [Причина 2]

**Структура для этого размера:**
- [A: простая / B: feature-based / C: monorepo]

Подтверждаете размер проекта?
```

---

## 📐 ЭТАП 2: ПЛАНИРОВАНИЕ

### Шаг 2.0: Технологическая карта

> **Обязательно перед кодом.** Скопируй шаблон `reference/templates/TECH_CARD_TEMPLATE.md` → `docs/TECH_CARD.md`.
> Заполни ВСЕ пункты на основе BRIEF.md и размера проекта.

```markdown
## Процесс заполнения

1. Пройди по каждой секции (1–11) шаблона TECH_CARD
2. Для каждого пункта:
   - Жёсткая практика → ставь стандартное решение
   - Адаптивное значение → предложи варианты, спроси разработчика
   - Не нужно в проекте → пиши "не нужно"
3. Покажи заполненную карту разработчику
4. Получи подтверждение по ВСЕМ пунктам
5. Поменяй статус на "утверждено"

❌ НЕ начинай код без утверждённой TECH_CARD
✅ После утверждения → переходи к архитектуре (Шаг 2.1)
```

### Шаг 2.1: Проектирование архитектуры

#### Для размера A (малый):

```
project/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (auth)/
│   │   │   ├── login/
│   │   │   └── register/
│   │   ├── (main)/
│   │   │   ├── page.tsx
│   │   │   └── products/
│   │   ├── api/
│   │   │   └── [...]/
│   │   ├── layout.tsx
│   │   └── globals.css
│   │
│   ├── components/
│   │   ├── ui/                 # Базовые UI компоненты
│   │   └── [feature]/          # По фичам
│   │
│   ├── lib/
│   │   ├── prisma.ts
│   │   ├── auth.ts
│   │   └── utils.ts
│   │
│   └── types/
│       └── index.ts
│
├── prisma/
│   └── schema.prisma
│
├── public/
├── docs/
│   ├── 01-ARCHITECTURE.md
│   ├── 02-TECH_STACK.md
│   └── PROGRESS.md
│
├── .env.example
├── .env.local
└── package.json
```

#### Для размера B (средний):

```
project/
├── src/
│   ├── app/                    # Next.js App Router
│   │   └── ...
│   │
│   ├── features/               # Фичи (главное!)
│   │   ├── auth/
│   │   │   ├── components/
│   │   │   ├── hooks/
│   │   │   ├── services/
│   │   │   ├── types.ts
│   │   │   └── index.ts
│   │   │
│   │   ├── products/
│   │   │   ├── components/
│   │   │   ├── hooks/
│   │   │   ├── services/
│   │   │   └── index.ts
│   │   │
│   │   └── orders/
│   │       └── ...
│   │
│   ├── shared/                 # Общее
│   │   ├── components/
│   │   │   └── ui/
│   │   ├── hooks/
│   │   ├── lib/
│   │   ├── types/
│   │   └── utils/
│   │
│   └── core/                   # Ядро
│       ├── config/
│       └── providers/
│
├── prisma/
├── docs/
├── tests/
└── ...
```

#### Для размера C (крупный):

```
project/
├── apps/
│   ├── web/                    # Next.js frontend
│   │   └── ...
│   └── api/                    # NestJS backend
│       └── ...
│
├── packages/
│   ├── ui/                     # Shared UI
│   ├── database/               # Prisma
│   ├── types/                  # Shared types
│   └── config/                 # Shared configs
│
├── docs/
├── tools/
└── ...
```

### Шаг 2.2: Выбор технологий

```markdown
## Стек технологий

### Frontend
| Технология | Версия | Назначение |
|------------|--------|------------|
| Next.js | 14/15 | Framework |
| React | 18 | UI Library |
| TypeScript | 5.x | Type safety |
| Tailwind CSS | 3.x | Styling |
| React Query | 5.x | Server state |
| Zustand | 4.x | Client state |
| React Hook Form | 7.x | Forms |
| Zod | 3.x | Validation |

### Backend (если B/C)
| Технология | Версия | Назначение |
|------------|--------|------------|
| NestJS | 10.x | Framework |
| Prisma | 5.x | ORM |
| PostgreSQL | 16 | Database |
| Neon | - | Managed Postgres |

### DevOps
| Технология | Назначение |
|------------|------------|
| Vercel | Hosting (frontend) |
| Railway/Render | Hosting (backend) |
| GitHub Actions | CI |
```

### Шаг 2.3: Проектирование БД (если нужна)

```markdown
## Схема базы данных

### Основные сущности

[Список таблиц с описанием]

### Диаграмма связей

```
User 1──* Order *──* Product
  │
  └──1 Cart 1──* CartItem *──1 Product
```

### Prisma Schema (черновик)

[Примерная схема]
```

### Шаг 2.4: Разбивка на этапы

```markdown
## Этапы разработки

### Этап 1: Базовая инфраструктура
- [ ] Настройка проекта
- [ ] База данных
- [ ] Аутентификация

### Этап 2: Основной функционал
- [ ] [Фича 1]
- [ ] [Фича 2]
- [ ] [Фича 3]

### Этап 3: Дополнительный функционал
- [ ] [Фича 4]
- [ ] [Фича 5]

### Этап 4: Финализация
- [ ] Тестирование
- [ ] Оптимизация
- [ ] Деплой
```

### Шаг 2.5: Согласование архитектуры

```markdown
## Предложение: Архитектура проекта

**Проект:** [Название]
**Размер:** [A/B/C]

---

### Структура папок

[Дерево папок]

---

### Технологии

[Таблица технологий]

---

### База данных

[Схема БД]

---

### Этапы разработки

[Список этапов]

---

**Вопросы:**
1. Согласны с предложенной архитектурой?
2. Есть ли дополнения к этапам?
3. Приоритеты функций верные?

Жду подтверждения для начала разработки.
```

---

## 🚀 ЭТАП 3: ИНИЦИАЛИЗАЦИЯ

### Шаг 3.0: Package manager — pnpm

> **pnpm — стандарт** для всех проектов. Быстрее установка, строгий node_modules, экономит диск.
> Если разработчик явно попросит npm — ок, но pnpm по умолчанию.

```bash
corepack enable && corepack prepare pnpm@latest --activate
```

### Шаг 3.1: Создание проекта

```bash
# Next.js проект (pnpm)
pnpm create next-app@latest project-name --typescript --tailwind --eslint --app --src-dir

# Или с Turborepo (для C)
pnpm dlx create-turbo@latest
```

### Шаг 3.2: Создаваемые файлы

После инициализации создаются:

```markdown
## Файлы конфигурации

- [ ] `tsconfig.json` — настроить strict, paths
- [ ] `.eslintrc.json` — добавить правила
- [ ] `.prettierrc` — создать
- [ ] `tailwind.config.ts` — настроить theme
- [ ] `.env.example` — все переменные

## Папка docs/

- [ ] `docs/01-ARCHITECTURE.md`
- [ ] `docs/02-TECH_STACK.md`  
- [ ] `docs/PROGRESS.md`

## База данных

- [ ] `prisma/schema.prisma`
- [ ] Первая миграция

## Структура src/

- [ ] Создать папки согласно размеру
- [ ] Базовые компоненты UI
- [ ] Провайдеры (if needed)
```

### Шаг 3.3: Шаблон docs/01-ARCHITECTURE.md

```markdown
# Архитектура: [Название проекта]

> [Краткое описание в 1-2 предложения]

**Размер:** [A/B/C]  
**Дата начала:** [YYYY-MM-DD]  
**Последнее обновление:** [YYYY-MM-DD]

---

## Обзор

[Описание проекта: что это, для кого, какую проблему решает]

---

## Технологии

| Категория | Технология | Версия | Назначение |
|-----------|------------|--------|------------|
| Frontend | Next.js | 14.x | Framework |
| ... | ... | ... | ... |

---

## Структура проекта

```
src/
├── app/
├── features/ (или components/)
├── shared/ (или lib/)
└── ...
```

---

## База данных

### Схема

[Описание основных таблиц]

### Связи

[Диаграмма связей]

---

## API

### Endpoints

| Метод | URL | Описание |
|-------|-----|----------|
| GET | /api/products | Список продуктов |
| ... | ... | ... |

---

## Ключевые решения

| Решение | Выбор | Причина |
|---------|-------|---------|
| State management | Zustand | Простой, легковесный |
| ... | ... | ... |
```

### Шаг 3.4: Шаблон docs/PROGRESS.md

```markdown
# Прогресс: [Название проекта]

**Текущий этап:** Этап 1 — Инициализация  
**Общий прогресс:** 10%  
**Последнее обновление:** [YYYY-MM-DD HH:MM]

---

## ✅ Выполнено

### Этап 0: Подготовка
- [x] ТЗ получено и проанализировано
- [x] Размер проекта определён: [A/B/C]
- [x] Архитектура согласована
- [x] Проект инициализирован

---

## 🔄 В работе

### Этап 1: Базовая инфраструктура
- [ ] Настройка БД и Prisma (0%)
- [ ] Аутентификация (0%)
- [ ] Базовый layout (0%)

---

## 📋 Запланировано

### Этап 2: Основной функционал
- [ ] [Фича 1]
- [ ] [Фича 2]

### Этап 3: Дополнительно
- [ ] [Фича 3]

---

## 📝 Заметки

[Важные заметки, вопросы, блокеры]
```

### Шаг 3.5: Шаблон .env.example

```bash
# Database (app_user для runtime, owner для миграций — см. 06-database)
DATABASE_URL="postgresql://app_user:password@ep-xxx-pooler.neon.tech/neondb?sslmode=require"
DIRECT_URL="postgresql://neon_owner:password@ep-xxx.neon.tech/neondb?sslmode=require"

# Auth
AUTH_SECRET="your-secret-here"            # Auth.js (NextAuth v5)
AUTH_URL="http://localhost:3000"

# Cloudflare R2 (обязательно — см. 08-security)
R2_ACCOUNT_ID=""
R2_ACCESS_KEY_ID=""
R2_SECRET_ACCESS_KEY=""
R2_BUCKET_NAME=""
R2_PUBLIC_URL=""

# External APIs (if needed)
# STRIPE_SECRET_KEY=""
# STRIPE_WEBHOOK_SECRET=""

# Feature Flags (optional)
# FEATURE_NEW_CHECKOUT="false"
```

---

## 💻 ЭТАП 4: РАЗРАБОТКА

### Процесс работы

```
┌──────────────────────────────────────────────────────┐
│  Для КАЖДОГО этапа из плана:                         │
│                                                       │
│  1. Объявить начало этапа                            │
│  2. Реализовать функционал                           │
│  3. Проверить по чеклисту (19-checklists)            │
│  4. Обновить PROGRESS.md                             │
│  5. Commit с Conventional Commits                    │
│  6. Сообщить о готовности этапа                      │
│  7. Получить подтверждение → следующий этап          │
└──────────────────────────────────────────────────────┘
```

### Шаблон начала этапа

```markdown
## Начинаю Этап [N]: [Название]

**Задачи этапа:**
1. [Задача 1]
2. [Задача 2]
3. [Задача 3]

**Ожидаемый результат:**
- [Что будет работать]

Приступаю к реализации.
```

### Шаблон завершения этапа

```markdown
## ✅ Этап [N] завершён: [Название]

**Что сделано:**
- [x] [Задача 1]
- [x] [Задача 2]
- [x] [Задача 3]

**Созданные файлы:**
- `src/features/auth/` — аутентификация
- `prisma/migrations/...` — миграция

**Как проверить:**
1. [Инструкция]
2. [Инструкция]

**Следующий этап:** Этап [N+1] — [Название]

Подтверждаете переход к следующему этапу?
```

### Commit после каждого этапа

```bash
# Формат
feat(scope): краткое описание

# Примеры
feat(auth): add user authentication with NextAuth
feat(products): implement product CRUD
feat(cart): add shopping cart functionality
fix(auth): fix session persistence issue
```

---

## ✅ ЭТАП 5: ФИНАЛИЗАЦИЯ

### Шаг 5.1: Финальная проверка по TECH_CARD

> Открой `docs/TECH_CARD.md` и пройди **сверху донизу**:

```markdown
## Проверка TECH_CARD

1. Секции 1–9: все пункты имеют статус ✅ или ➖
2. Секция 10 (безопасность): все ✅
3. Секция 11 (документация): все ✅
4. Секция 12 (финальная проверка): пройди каждый пункт

Если есть ⬜ или 🔄 — заверши или объясни почему пропущено.
```

### Шаг 5.2: Проверка по главному чеклисту

> Дополнительно используй `19-checklists.mdc` — секция "ГЛАВНЫЙ ЧЕКЛИСТ СООТВЕТСТВИЯ"

### Шаг 5.3: Финальное обновление документации

```markdown
## Финальная документация

- [ ] docs/01-ARCHITECTURE.md — актуальна
- [ ] docs/02-TECH_STACK.md — все технологии
- [ ] docs/PROGRESS.md — 100%
- [ ] README.md — инструкция запуска
- [ ] .env.example — все переменные
- [ ] API документация (Swagger если есть)
```

### Шаг 5.4: Подготовка к деплою

> Попроси разработчика подготовить production-окружение (см. правило "Запрос данных" в 00-core.mdc).

```markdown
## Деплой Checklist

### Vercel (Frontend)
- [ ] Репозиторий подключён
- [ ] Environment Variables настроены
- [ ] Build проходит
- [ ] Preview работает

### Neon (Database)
- [ ] Production branch создан
- [ ] Connection string в Vercel
- [ ] Миграции применены
- [ ] Роли настроены (app_user, не owner)

### Финальная проверка
- [ ] Production работает
- [ ] Все функции работают
- [ ] Нет ошибок в консоли
- [ ] TECH_CARD статус → "завершён"
```

---

## 📊 ИТОГОВАЯ СТРУКТУРА ФАЙЛОВ ПРОЕКТА

```
project/
├── src/                        # Код
│   ├── app/                    # Pages (Next.js)
│   ├── features/ или components/
│   ├── shared/ или lib/
│   └── types/
│
├── prisma/                     # База данных
│   ├── schema.prisma
│   └── migrations/
│
├── docs/                       # Документация
│   ├── 01-ARCHITECTURE.md      # ✅ Создаётся на этапе 3
│   ├── 02-TECH_STACK.md        # ✅ Создаётся на этапе 3
│   ├── PROGRESS.md             # ✅ Обновляется постоянно
│   └── DECISIONS.md            # По необходимости
│
├── tests/                      # Тесты
│
├── public/                     # Статика
│
├── .env.example                # ✅ Создаётся на этапе 3
├── .env.local                  # Локальные переменные (не в git)
├── package.json
├── tsconfig.json
├── tailwind.config.ts
├── .eslintrc.json
├── .prettierrc
├── .gitignore
└── README.md
```

---

## 🔄 КРАТКАЯ ШПАРГАЛКА

```
1. ТЗ → Анализ → Определить размер (A/B/C) → СОГЛАСОВАТЬ

2. Архитектура:
   - Структура папок
   - Технологии
   - БД схема
   - Этапы разработки
   → СОГЛАСОВАТЬ

3. Инициализация:
   - create-next-app
   - Конфиги
   - docs/ папка
   - .env.example
   - Первый commit

4. Разработка (для каждого этапа):
   - Объявить начало
   - Реализовать
   - Обновить PROGRESS.md
   - Commit
   - Сообщить о готовности
   → ПОДТВЕРЖДЕНИЕ → следующий этап

5. Финализация:
   - Чеклист (19-checklists)
   - Документация
   - Деплой
```

---

**Версия:** 1.1
**Дата:** 2026-02-12
